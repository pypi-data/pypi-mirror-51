{% extends "bee_django_referral/base.html" %}
{% load static %}
{% block title %}遇见古琴{% endblock %}
{% block styles %}
    <style>
        body {
            background-color: #1d9bca;
            background-image: none;
            padding: 10px;
        }

        .container {
            margin: auto;
            max-width: 512px;
        }

        .reg_div {
            background-color: #FFFFFF;
            border: 2px solid #1b5b8b;
            border-radius: 10px;
            text-align: center;
        }

        .reg_title_div img {
            width: 70%;
        }

        .reg_body_div {
            margin-top: 10px;
            padding: 20px;

        }

        .name_div {
            margin: 5px;
            color: #1b5b8b;
            font-size: 18px;

        }

        .info_div {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .row_div {
            width: 100%;
            border: 1px solid #bababa;
            margin: 10px auto;
            height: 45px;
            padding: 10px;
        }

        .icon_div {
            display: inline-block;
            padding-right: 10px;
            border-right: 1px solid #bababa;
            background: url({% static 'bee_django_referral/img/reg_icon.png' %}) no-repeat;
            width: 40px;
            height: 100%;

        }

        .icon_name {
            background-position: 0 -68px;
        }

        .icon_mobile {
            background-position: 0 -140px;
        }

        .icon_gender {
            background-position: -72px -105px;
        }

        .icon_city {
            background-position: 0 0;

        }

        .icon_wx {
            background-position: 0 -211px;
        }

        .input_div {
            padding-left: 5px;
            display: inline-block;
            position: relative;
            top: -5px;

        }

        input {
            border: 0;
            max-width: 150px;
        }


    </style>
{% endblock %}
{% block content %}
    <div style="margin-bottom: 20px;"></div>

    {#    <div class="reg_div reg_title_div">#}
    {#        <img src="/static/img/referral/title_m2.jpg">#}
    {#    </div>#}
    <div class="reg_div reg_body_div">
        {% if not error_message %}
            {% if qrcode_unused %}
                <div class="text-center name_div">
                    {% if source_name %}
                        {{ source_name }}
                    {% elif manUser.name %}
                        缦客{{ manUser.name }}
                    {% endif %}
                </div>
                <div class="text-center info_div">

                    邀请你遇见古琴
                    <div id="form">
                        <div class="row_div text-left" onclick="click_row(this)">
                            <div class="icon_div icon_name"></div>
                            <div class="input_div"><input id="name" type="text" placeholder="姓名（必填）"></div>
                        </div>
                        <div class="row_div text-left" onclick="click_row(this)">
                            <div class="icon_div icon_mobile">
                            </div>
                            <div class="input_div"><input id="mobile" type="text" placeholder="手机号（必填）"></div>
                        </div>
                        <div class="row_div text-left">
                            <div class="icon_div icon_gender"></div>
                            <div class="input_div"><input type="radio" name="gender" value="男">男&nbsp;&nbsp;&nbsp;&nbsp;
                                <input type="radio" name="gender" value="女">女
                            </div>
                        </div>
                        <div class="row_div text-left" onclick="click_row(this)">
                            <div class="icon_div icon_city"></div>
                            <div class="input_div">

<span id="_city">
                    <select class="prov"></select>
                    <select class="city" disabled="disabled"></select>
                </span>

                            </div>
                        </div>
                        {#            <div class="row_div text-left" onclick="click_row(this)">#}
                        {#                <div class="icon_div icon_wx"></div>#}
                        {#                <div class="input_div"><input id="wx" type="text" placeholder="微信号"></div>#}
                        {#            </div>#}
                        <div style="margin-top:25px;">
                            <button style="width: 100%;height: 40px;font-size: 18px;" class="btn btn-warning"
                                    onclick="click_save()">确&nbsp;&nbsp;&nbsp;&nbsp;定
                            </button>
                        </div>
                    </div>

                </div>
            {% else %}
                <div>此二维码已经被使用</div>
            {% endif %}
        {% else %}
            <div>{{ error_message }}</div>
        {% endif %}
    </div>



{% endblock %}
{% block scripts %}
    <script>
        var Request;
        var m;
        $(document).ready(function () {
            Request = new QueryString();
            var $name_div = $(".name_div");

            $("#_city").citySelect({
                url: "/static/cityselect/js/city.min.js",
                nodata: true,
                required: false
            });
        });
        function click_row(_this) {
            var $row = $(_this);
            $row.find('input').focus();
        }
        function click_save() {

            var token = Request["token"];
            var source_id = Request["source_id"];
            var t = Request["t"];
            var name = $("#name").val();
            var mobile = $("#mobile").val();
            var wx = $("#wx").val();
            var prov = $(".prov").val();
            var city = $(".city").val();

            var gender = $("input[name='gender']:checked").val();
            if (!name || !mobile) {
                alert("请填写完整");
                return;
            }


            $.post('{% url "crm:api_save_preUser_qrcode" %}', {
                "token": token,
                'source_id': source_id,
                'activity_id': '{{ activity_id }}',
                "t": t,
                "name": name,
                "mobile": mobile,
                "prov": prov,
                "city": city,
                "gender": gender,
                "wx": wx
            }, function (res) {

                if (res.error == 0) {
                    location.href = "{% url 'referral:reg_finished' %}";
                } else {
                    alert(res.msg);
                }

            });
        }
    </script>
{% endblock %}