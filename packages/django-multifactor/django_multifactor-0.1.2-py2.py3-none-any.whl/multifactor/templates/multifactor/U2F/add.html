{% extends "multifactor/base.html" %}{% load static %}

{% block card_title %}U2F Security Key{% endblock %}
{% block card_classes %}card-login mx-auto{% endblock %}

{% block content %}
<div class="alert alert-success mb-0" id="res">
    Your secure Key should be flashing now, please press button.
</div>

<form action="" method="POST" id="u2f_login">
    {% csrf_token %}
    <input type="hidden" id="response" name="response" value=""/>
</form>
{% endblock %}

{% block head %}
<script src="{% static 'multifactor/js/u2f-api.js' %}" type="text/javascript"></script>
<script type="text/javascript">
data = JSON.parse('{{ token|safe }}');
u2f.register(data.appId, data.registerRequests, data.registeredKeys, function (response) {
    $('#response').val(JSON.stringify(response))
    $('#u2f_login').submit()
}, 5000);
</script>
{% endblock %}
